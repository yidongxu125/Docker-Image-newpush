# ðŸ³ Docker Image Syncer (é•œåƒæ¬è¿å·¥)

åˆ©ç”¨ GitHub Actions çš„å…è´¹ç®—åŠ›å’Œé«˜é€Ÿç½‘ç»œï¼Œå°† DockerHub çš„é•œåƒæ¬è¿åˆ° **é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ (ACR)** æˆ– **GitHub Packages (GHCR)**ã€‚

**âœ¨ æ ¸å¿ƒä¼˜åŠ¿ (Proç‰ˆ):**

1.  **å¤šæž¶æž„æ”¯æŒ**ï¼šæ”¯æŒæŒ‡å®š `--platform` (å¦‚ `linux/arm64`)ï¼Œå®Œç¾Žé€‚é…æ ‘èŽ“æ´¾ã€M1/M2 Mac ç­‰è®¾å¤‡ã€‚
2.  **æž¶æž„æ„ŸçŸ¥æ™ºèƒ½åŒæ­¥**ï¼š
    *   **è§£å†³å®˜æ–¹é•œåƒè¯¯åˆ¤**ï¼šè„šæœ¬ä¼šç²¾å‡†æ¯”å¯¹**ç‰¹å®šæž¶æž„**çš„æ‘˜è¦ (Digest)ï¼ŒçœŸæ­£å®žçŽ°â€œå†…å®¹ä¸å˜åˆ™è·³è¿‡â€ã€‚
    *   **åŒé‡æ ¡éªŒæœºåˆ¶**ï¼šä¸ä»…æ¯”å¯¹æ‘˜è¦ (Digest)ï¼Œè¿˜ä¼šæ¯”å¯¹é•œåƒåˆ›å»ºæ—¶é—´ (Created)ã€‚é˜²æ­¢å›  Registry åŽ‹ç¼©ç®—æ³•ä¸åŒå¯¼è‡´çš„æ­»å¾ªçŽ¯æŽ¨é€ã€‚
3.  **æžè‡´ç©ºé—´ä¼˜åŒ–**ï¼š
    *   æ”¯æŒ**ç£ç›˜æ¸…ç†å¼€å…³**ï¼Œé˜²æ­¢ Runner ç©ºé—´ä¸è¶³ã€‚
    *   **å³ä¸‹å³åˆ **ï¼šæŽ¨é€å®Œä¸€ä¸ªé•œåƒç«‹å³æ¸…ç†ï¼Œæ”¯æŒå¤§æ‰¹é‡åŒæ­¥ã€‚
4.  **æ™ºèƒ½å‘½åç­–ç•¥**ï¼š
    *   è‡ªåŠ¨å¤„ç†å‘½åç©ºé—´å†²çªï¼ˆå¦‚ `bitnami/nginx` -> `bitnami_nginx`ï¼‰ã€‚
    *   è‡ªåŠ¨é€‚é… GHCR çš„å°å†™å‘½åè¦æ±‚ã€‚

---

![Last Sync](https://img.shields.io/badge/last%20sync-2026--01--15%2009:03:57-green)

## âš¡ å¿«é€Ÿå¼€å§‹ (Quick Start)

1.  ç‚¹å‡»ä»“åº“å³ä¸Šè§’çš„ **[Use this template]** æŒ‰é’®ï¼Œé€‰æ‹© **Create a new repository**ã€‚
2.  å»ºè®®è®¾ä¸º **Public** (Public ä»“åº“ä½¿ç”¨ GHCR å­˜å‚¨ç©ºé—´æ— é™åˆ¶ï¼Œä¸”æ‹‰å–å…é‰´æƒ)ã€‚
3.  æŒ‰ç…§ä¸‹æ–¹ [é…ç½® Secrets](#%EF%B8%8F-%E9%85%8D%E7%BD%AE-secrets) å®Œæˆè®¾ç½®ã€‚
4.  **ä¿®æ”¹é…ç½®**ï¼šæ ¹æ®éœ€è¦ä¿®æ”¹ `config.env` æ–‡ä»¶ï¼ˆè®¾ç½®åŒæ­¥æ¨¡å¼ç­‰ï¼‰ã€‚

---

## ðŸ› ï¸ é…ç½®è¯´æ˜Ž (Configuration)

### 1. Secrets è®¾ç½®
è¿›å…¥ä»“åº“çš„ **Settings** -> **Secrets and variables** -> **Actions** -> **New repository secret**ï¼š

| Secret Name | å¿…å¡« | è¯´æ˜Ž | ç¤ºä¾‹ |
| --- | --- | --- | --- |
| `ALIYUN_REGISTRY` | âœ… | é˜¿é‡Œäº‘ ACR å…¬ç½‘åœ°å€ | `registry.cn-hangzhou.aliyuncs.com` |
| `ALIYUN_NAMESPACE` | âœ… | ä½ çš„å‘½åç©ºé—´ | `develata` |
| `ALIYUN_USERNAME` | âœ… | é˜¿é‡Œäº‘ç™»å½•è´¦å· | `username@123.onaliyun.com` |
| `ALIYUN_PASSWORD` | âœ… | é˜¿é‡Œäº‘ **è®¿é—®å‡­è¯å¯†ç ** | `Mypassword123` |
| `DOCKERHUB_USERNAME` | âŒ | DockerHub ç”¨æˆ·å (é˜²é™æµ) | `myuser` |
| `DOCKERHUB_TOKEN` | âŒ | DockerHub Token (æŽ¨è) | `dckr_pat_xxx` |
| `WEBHOOK_URL` | âŒ | æ¶ˆæ¯é€šçŸ¥ Webhook | `https://open.feishu.cn/...` |

### 2. é…ç½®æ–‡ä»¶ (`config.env`)
é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `config.env` æŽ§åˆ¶å…¨å±€è¡Œä¸ºï¼š

```bash
# åŒæ­¥æ¨¡å¼: aliyun, ghcr, double, none
SYNC_MODE=aliyun

# ç£ç›˜æ¸…ç†: true (é»˜è®¤) / false
# å¼€å¯å¯é‡Šæ”¾çº¦ 2GB ç©ºé—´ï¼Œä½†ä¼šå¢žåŠ  2-4 åˆ†é’Ÿè¿è¡Œæ—¶é—´
CLEAN_DISK_SPACE=true
```

### 3. Webhook é…ç½®æŒ‡å—
ä»¥**é£žä¹¦ (Feishu)** ä¸ºä¾‹ï¼š
1.  åœ¨é£žä¹¦ç¾¤ç»„ä¸­æ·»åŠ â€œè‡ªå®šä¹‰æœºå™¨äººâ€ã€‚
2.  **ä¸éœ€è¦**åœ¨é£žä¹¦è®¾ç½®ç‰¹å®šçš„â€œå…³é”®å­—â€æˆ–â€œIPç™½åå•â€ï¼ˆå¦‚æžœè„šæœ¬æŠ¥é”™ï¼Œæ£€æŸ¥æ˜¯å¦è¢«æ‹¦æˆªï¼Œé€šå¸¸åªéœ€èŽ·å– URLï¼‰ã€‚
3.  å¤åˆ¶ Webhook URL (æ ¼å¼å¦‚ `https://open.feishu.cn/open-apis/bot/v2/hook/xxx`)ã€‚
4.  å¡«å…¥ GitHub Secrets çš„ `WEBHOOK_URL` ä¸­ã€‚
*æœ¬ç¨‹åºå·²å†…ç½® JSON æ¶ˆæ¯æ ¼å¼ï¼Œæ— éœ€ç”¨æˆ·åœ¨é£žä¹¦ç«¯é…ç½®æ¶ˆæ¯æ¨¡æ¿ã€‚*

---

## ðŸš€ å·¥ä½œæµé€‰æ‹© Guide

æœ¬é¡¹ç›®åŒ…å« **3 ç±»** å·¥ä½œæµï¼Œè¯·æ ¹æ®éœ€æ±‚é€‰æ‹©ï¼š

### 1. è‡ªåŠ¨æ‰¹é‡åŒæ­¥ (`01. Batch Sync`)
*   **é€‚ç”¨åœºæ™¯**ï¼šæ—¥å¸¸å¤§æ‰¹é‡åŒæ­¥ï¼Œæ— äººå€¼å®ˆã€‚
*   **è§¦å‘æ–¹å¼**ï¼š
    *   ä¿®æ”¹ `images.txt` æŽ¨é€ã€‚
    *   å®šæ—¶è§¦å‘ (Schedule)ã€‚
    *   æ‰‹åŠ¨è§¦å‘ (Workflow Dispatch)ã€‚
*   **é…ç½®**ï¼š
    *   **é•œåƒåˆ—è¡¨**ï¼šè¯»å–æ ¹ç›®å½• `images.txt`ã€‚
    *   **åŒæ­¥ç›®æ ‡**ï¼šå®Œå…¨ç”± `config.env` ä¸­çš„ `SYNC_MODE` å†³å®šã€‚
    *   **ç£ç›˜æ¸…ç†**ï¼šç”± `config.env` ä¸­çš„ `CLEAN_DISK_SPACE` å†³å®šã€‚

**`images.txt` ç¤ºä¾‹** (æ›´å¤šè¯¦è§ `images.example.txt`)ï¼š
```text
nginx:alpine
--platform=linux/arm64 mysql:8.0
bitnami/redis:latest
```

### 2. åŒé‡åŒæ­¥ (`02. Double Sync`)
*   **é€‚ç”¨åœºæ™¯**ï¼šä¸´æ—¶æ‰‹åŠ¨åŒæ­¥ä¸€ä¸ªé•œåƒï¼ŒåŒæ—¶æŽ¨é€åˆ° é˜¿é‡Œäº‘ å’Œ GHCRã€‚
*   **ç‰¹ç‚¹**ï¼šä¸‰æ–¹æ¯”å¯¹ï¼ˆæº vs é˜¿é‡Œ vs GHCRï¼‰ï¼Œæ™ºèƒ½åˆ¤æ–­å“ªä¸€æ–¹éœ€è¦æ›´æ–°ã€‚
*   **æ‰‹åŠ¨å‚æ•°**ï¼š
    *   `image_name`: åŽŸé•œåƒåã€‚
    *   `target_name`: (å¯é€‰) é‡å‘½åã€‚
    *   `clean_disk`: æ˜¯å¦æ¸…ç†ç£ç›˜ (é»˜è®¤ False ä»¥èŠ‚çœæ—¶é—´)ã€‚

### 3. å•é¡¹åŒæ­¥ (`03. To Aliyun` / `04. To GHCR`)
*   **é€‚ç”¨åœºæ™¯**ï¼šåªæŽ¨é€åˆ°æŸä¸€ä¸ªç‰¹å®šçš„ä»“åº“ã€‚
*   **ç‰¹ç‚¹**ï¼š**ä¸è¯»å–** `images.txt`ï¼Œä»…å¤„ç†æœ¬æ¬¡è¾“å…¥çš„é•œåƒã€‚
*   **ç‹¬ç«‹æ€§**ï¼šä½ å¯ä»¥ç”¨å®ƒæ¥ä¸´æ—¶æ¬è¿ä¸€ä¸ªä¸åœ¨åˆ—è¡¨é‡Œçš„é•œåƒã€‚

---

## â“ å¸¸è§é—®é¢˜ (FAQ)

### Q1: å…³äºŽç£ç›˜æ¸…ç† (Disk Space)
**çŽ°è±¡**ï¼šWorkflow å¼€å¤´ç»å¸¸è¦è·‘å‡ åˆ†é’Ÿ "Maximize Build Space"ã€‚
**è§£é‡Š**ï¼šGitHub Runner é»˜è®¤ç£ç›˜ç©ºé—´æœ‰é™ï¼ˆçº¦ 14GB å¯ç”¨ï¼‰ã€‚å¦‚æžœåŒæ­¥å¤§é•œåƒï¼ˆå¦‚ PyTorch, TensorFlowï¼‰ï¼Œå¾ˆå®¹æ˜“çˆ†ç›˜ã€‚è„šæœ¬ä¼šé¢„å…ˆç§»é™¤ .NET, Android ç­‰ç»„ä»¶é‡Šæ”¾ç©ºé—´ã€‚
**è°ƒæ•´**ï¼š
*   å¦‚æžœåªæ˜¯åŒæ­¥ nginx è¿™ç§å°é•œåƒï¼Œå¯ä»¥åœ¨ `config.env` æŠŠ `CLEAN_DISK_SPACE` è®¾ä¸º `false`ã€‚
*   æ‰‹åŠ¨åŒæ­¥æ—¶ï¼Œå–æ¶ˆå‹¾é€‰ `clean_disk` é€‰é¡¹ã€‚

### Q2: å…³äºŽæž¶æž„æŒ‡å®š (/v8 é—®é¢˜)
**é—®**ï¼šé•œåƒåæ˜¯ `linux/arm64/v8`ï¼Œæˆ‘è¯¥æ€Žä¹ˆå†™ï¼Ÿ
**ç­”**ï¼šåªéœ€è¦å†™ `--platform=linux/arm64` å³å¯ã€‚Docker å¼•æ“Žä¼šè‡ªåŠ¨åå•†æœ€åŒ¹é…çš„å˜ä½“ (Variant)ã€‚ä¸éœ€è¦æ˜¾å¼å†™ `/v8`ï¼Œå¦åˆ™å¯èƒ½ä¼šæŠ¥é”™ã€‚

### Q3: ä¸ºä»€ä¹ˆ GHCR 403 Forbidden?
1.  ç¡®ä¿åœ¨ GitHub ä¸ªäººè®¾ç½® -> Developer Settings å¼€å¯äº† `write:packages` æƒé™ï¼ˆå¦‚æžœæ˜¯ç”¨ Tokenï¼‰ã€‚
2.  æœ¬ Actions é»˜è®¤ä½¿ç”¨ `${{ secrets.GITHUB_TOKEN }}`ï¼Œè¯·æ£€æŸ¥ä»“åº“ Settings -> Actions -> General -> **Workflow permissions** å¿…é¡»è®¾ä¸º **Read and write permissions**ã€‚

---

## ðŸ“œ License

MIT License.
